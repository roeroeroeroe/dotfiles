#!/usr/bin/env bash

ip -4 -o a | awk '
	{
		iface = $2
		ip = $4
		sub(/\/.*/, "", ip)
		if (system("[[ -d /sys/class/net/" iface " && -L /sys/class/net/" iface "/device ]]") == 0)
			print iface, ip
	}' | while read -r IFACE IP
do
	printf "%s: %s -> " "$IFACE" "$IP"
	printf "%s\n" "$(curl -sm 10 --interface "$IFACE" https://api.ipify.org)"
done
